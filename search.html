<!doctype html>
<html>
<head>
  <title>Instant Search Tutorial</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <!-- IE < 10 support -->
  <!--[if lte IE 9]>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.css">
  <link rel="stylesheet" type="text/css" href="./assets/style.css">
</head>
<body>

<!-- INTERFACE -->
<header>
  <a href="."><img src="./assets/img/instant_search_logo@2x.png"/></a>
  <div id="search-input"></div>
  <div id="search-input-icon"></div>
</header>

<main>
  <div id="left-column">
    <div id="category" class="facet"></div>
    <div id="brand" class="facet"></div>
    <div id="price" class="facet"></div>
    <div id="type" class="facet"></div>
  </div>

  <div id="right-column">
    <div id="sort-by-wrapper"><span id="sort-by"></span></div>
    <div id="stats"></div>
    <div id="hits"></div>
    <div id="pagination"></div>
  </div>
</main>

<footer>
  Source Code on <a href="https://github.com/algolia/examples/blob/master/instant-search/instantsearch.js">Github</a> -
  Powered by <a href="https://www.algolia.com">Algolia</a> - Data from <a href="https://developer.bestbuy.com">Best Buy</a>
</footer>
<!-- /INTERFACE -->

<!-- TEMPLATES -->
<script type="text/html" id="hit-template">
  <div class="hit">
    <div class="hit-image">
      <img src="{{image}}" alt="{{name}}">
    </div>
    <div class="hit-content">
      <h3 class="hit-price">${{price}}</h3>
      <h2 class="hit-name">{{{_highlightResult.name.value}}}</h2>
      <p class="hit-description">{{{_highlightResult.description.value}}}</p>
    </div>
  </div>
</script>

<script type="text/html" id="no-results-template">
  <div id="no-results-message">
    <p>We didn't find any results for the search <em>"{{query}}"</em>.</p>
    <a href="." class='clear-all'>Clear search</a>
  </div>
</script>
<!-- /TEMPLATES -->

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.js"></script>
<script>
  /* global instantsearch */

  app({
    appId: 'latency',
    apiKey: '6be0576ff61c053d5f9a3225e2a90f76',
    indexName: 'instant_search',
  });

  function app(opts) {
    const search = instantsearch({
      appId: opts.appId,
      apiKey: opts.apiKey,
      indexName: opts.indexName,
      urlSync: true,
    });

    search.addWidget(
      instantsearch.widgets.searchBox({
        container: '#search-input',
        placeholder: 'Search for products',
      })
    );

    search.addWidget(
      instantsearch.widgets.hits({
        container: '#hits',
        hitsPerPage: 10,
        templates: {
          item: getTemplate('hit'),
          empty: getTemplate('no-results'),
        },
      })
    );

    search.addWidget(
      instantsearch.widgets.stats({
        container: '#stats',
      })
    );

    search.addWidget(
      instantsearch.widgets.sortBySelector({
        container: '#sort-by',
        autoHideContainer: true,
        indices: [{
          name: opts.indexName, label: 'Most relevant',
        }, {
          name: `${opts.indexName}_price_asc`, label: 'Lowest price',
        }, {
          name: `${opts.indexName}_price_desc`, label: 'Highest price',
        }],
      })
    );

    search.addWidget(
      instantsearch.widgets.pagination({
        container: '#pagination',
        scrollTo: '#search-input',
      })
    );

    search.addWidget(
      instantsearch.widgets.refinementList({
        container: '#category',
        attributeName: 'categories',
        sortBy: ['isRefined', 'count:desc', 'name:asc'],
        limit: 10,
        operator: 'or',
        templates: {
          header: getHeader('Category'),
        },
      })
    );

    search.addWidget(
      instantsearch.widgets.refinementList({
        container: '#brand',
        attributeName: 'brand',
        sortBy: ['isRefined', 'count:desc', 'name:asc'],
        limit: 10,
        operator: 'or',
        searchForFacetValues: {
          placeholder: 'Search for brands',
          templates: {
            noResults: '<div class="sffv_no-results">No matching brands.</div>',
          },
        },
        templates: {
          header: getHeader('Brand'),
        },
      })
    );

    search.addWidget(
      instantsearch.widgets.rangeSlider({
        container: '#price',
        attributeName: 'price',
        templates: {
          header: getHeader('Price'),
        },
      })
    );

    search.addWidget(
      instantsearch.widgets.refinementList({
        container: '#type',
        attributeName: 'type',
        sortBy: ['isRefined', 'count:desc', 'name:asc'],
        limit: 10,
        operator: 'and',
        templates: {
          header: getHeader('Type'),
        },
      })
    );

    search.start();
  }

  function getTemplate(templateName) {
    return document.querySelector(`#${templateName}-template`).innerHTML;
  }

  function getHeader(title) {
    return `<h5>${title}</h5>`;
  }
</script>
<!-- /SCRIPTS -->
</body>
</html>
